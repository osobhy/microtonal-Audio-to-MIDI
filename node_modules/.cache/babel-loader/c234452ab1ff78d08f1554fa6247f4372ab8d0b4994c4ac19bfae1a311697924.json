{"ast":null,"code":"var _jsxFileName = \"/root/Audiotomidi/src/components/PianoRoll.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useState } from 'react';\nimport { motion } from 'framer-motion';\nimport { Music, Play, Pause, Volume2 } from 'lucide-react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PianoRoll = ({\n  midiData,\n  isConverting\n}) => {\n  _s();\n  var _midiData$notes;\n  const canvasRef = useRef(null);\n  const [dimensions, setDimensions] = useState({\n    width: 0,\n    height: 0\n  });\n  const [zoom, setZoom] = useState(2.5); // Start more zoomed in\n  const [scrollX, setScrollX] = useState(0);\n\n  // MIDI playback state\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [volume, setVolume] = useState(0.7);\n  const audioContextRef = useRef(null);\n  const playbackStartTimeRef = useRef(0);\n  const animationFrameRef = useRef(null);\n\n  // Piano key names - reduced range for less cramped view\n  const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\n  const octaves = [6, 5, 4, 3]; // Reduced octave range\n  const pianoKeys = [];\n  octaves.forEach(octave => {\n    noteNames.forEach(note => {\n      pianoKeys.push(`${note}${octave}`);\n    });\n  });\n  useEffect(() => {\n    const updateDimensions = () => {\n      if (canvasRef.current) {\n        const rect = canvasRef.current.getBoundingClientRect();\n        setDimensions({\n          width: rect.width,\n          height: rect.height\n        });\n      }\n    };\n    updateDimensions();\n    window.addEventListener('resize', updateDimensions);\n    return () => window.removeEventListener('resize', updateDimensions);\n  }, []);\n  useEffect(() => {\n    if (!canvasRef.current || !midiData || !dimensions.width) return;\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext('2d');\n\n    // Set canvas size\n    canvas.width = dimensions.width;\n    canvas.height = dimensions.height;\n\n    // Clear canvas\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // Draw grid\n    drawGrid(ctx, canvas.width, canvas.height);\n\n    // Draw notes if available\n    if (midiData.notes) {\n      drawNotes(ctx, midiData.notes, canvas.width, canvas.height);\n    }\n  }, [midiData, dimensions, zoom, scrollX]);\n\n  // MIDI Synthesizer\n  const createSynth = () => {\n    if (!audioContextRef.current) {\n      audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();\n    }\n    return audioContextRef.current;\n  };\n  const playNote = (frequency, startTime, duration, velocity = 100) => {\n    const audioContext = createSynth();\n    const gainNode = audioContext.createGain();\n    const oscillator = audioContext.createOscillator();\n\n    // Connect nodes\n    oscillator.connect(gainNode);\n    gainNode.connect(audioContext.destination);\n\n    // Set oscillator properties\n    oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);\n    oscillator.type = 'triangle'; // Warm, musical sound\n\n    // Set envelope\n    const velocityGain = velocity / 127 * volume;\n    gainNode.gain.setValueAtTime(0, audioContext.currentTime);\n    gainNode.gain.linearRampToValueAtTime(velocityGain, audioContext.currentTime + 0.01);\n    gainNode.gain.exponentialRampToValueAtTime(velocityGain * 0.3, audioContext.currentTime + duration);\n    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration + 0.1);\n\n    // Start and stop\n    oscillator.start(audioContext.currentTime + startTime);\n    oscillator.stop(audioContext.currentTime + startTime + duration + 0.1);\n  };\n  const midiNoteToFrequency = note => {\n    return 440 * Math.pow(2, (note - 69) / 12);\n  };\n  const startPlayback = () => {\n    if (!midiData || !midiData.notes) return;\n    setIsPlaying(true);\n    setCurrentTime(0);\n    const audioContext = createSynth();\n    playbackStartTimeRef.current = audioContext.currentTime;\n\n    // Schedule all notes\n    midiData.notes.forEach(note => {\n      const frequency = midiNoteToFrequency(note.pitch);\n      const duration = note.end - note.start;\n      playNote(frequency, note.start, duration, note.velocity);\n    });\n\n    // Update playback position\n    const updatePlayback = () => {\n      if (!isPlaying) return;\n      const elapsed = audioContext.currentTime - playbackStartTimeRef.current;\n      setCurrentTime(elapsed);\n      if (elapsed < midiData.duration) {\n        animationFrameRef.current = requestAnimationFrame(updatePlayback);\n      } else {\n        setIsPlaying(false);\n        setCurrentTime(0);\n      }\n    };\n    updatePlayback();\n  };\n  const stopPlayback = () => {\n    setIsPlaying(false);\n    setCurrentTime(0);\n    if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n    }\n  };\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    };\n  }, []);\n  const drawGrid = (ctx, width, height) => {\n    const gridSize = 30 * zoom; // Larger grid spacing\n    const keyHeight = height / pianoKeys.length;\n\n    // Draw horizontal lines (piano keys) - more subtle\n    ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';\n    ctx.lineWidth = 0.5;\n    for (let i = 0; i <= pianoKeys.length; i++) {\n      const y = i * keyHeight;\n      ctx.beginPath();\n      ctx.moveTo(0, y);\n      ctx.lineTo(width, y);\n      ctx.stroke();\n    }\n\n    // Draw vertical lines (time grid) - more subtle\n    ctx.strokeStyle = 'rgba(255, 255, 255, 0.08)';\n    for (let x = 0; x <= width; x += gridSize) {\n      ctx.beginPath();\n      ctx.moveTo(x - scrollX, 0);\n      ctx.lineTo(x - scrollX, height);\n      ctx.stroke();\n    }\n\n    // Removed note labels for cleaner look\n  };\n  const drawNotes = (ctx, notes, width, height) => {\n    const keyHeight = height / pianoKeys.length;\n    const timeScale = 150 * zoom; // Increased time scale for better visibility\n\n    notes.forEach(note => {\n      const noteIndex = note.pitch - 21; // MIDI note 21 is A0\n      if (noteIndex >= 0 && noteIndex < pianoKeys.length) {\n        const y = noteIndex * keyHeight;\n        const x = note.start * timeScale - scrollX;\n        const noteWidth = (note.end - note.start) * timeScale;\n        const noteHeight = keyHeight * 0.9; // Slightly larger notes\n\n        // Check if note is currently playing\n        const isCurrentlyPlaying = isPlaying && currentTime >= note.start && currentTime <= note.end;\n\n        // Draw note rectangle with better colors\n        const gradient = ctx.createLinearGradient(x, y, x + noteWidth, y);\n        if (isCurrentlyPlaying) {\n          // Highlight currently playing notes\n          gradient.addColorStop(0, '#fbbf24'); // Yellow\n          gradient.addColorStop(0.5, '#f59e0b'); // Orange\n          gradient.addColorStop(1, '#d97706'); // Dark orange\n        } else {\n          gradient.addColorStop(0, '#60a5fa'); // Lighter blue\n          gradient.addColorStop(0.5, '#8b5cf6'); // Purple\n          gradient.addColorStop(1, '#a855f7'); // Lighter purple\n        }\n        ctx.fillStyle = gradient;\n        ctx.fillRect(x, y + keyHeight * 0.05, noteWidth, noteHeight);\n\n        // Draw note border with glow effect\n        ctx.strokeStyle = isCurrentlyPlaying ? 'rgba(255, 255, 255, 0.8)' : 'rgba(255, 255, 255, 0.4)';\n        ctx.lineWidth = isCurrentlyPlaying ? 2 : 1.5;\n        ctx.strokeRect(x, y + keyHeight * 0.05, noteWidth, noteHeight);\n      }\n    });\n  };\n  const formatTime = time => {\n    const minutes = Math.floor(time / 60);\n    const seconds = Math.floor(time % 60);\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n  };\n  const handleWheel = e => {\n    e.preventDefault();\n    if (e.ctrlKey || e.metaKey) {\n      // Zoom\n      const newZoom = Math.max(1, Math.min(5, zoom - e.deltaY * 0.001));\n      setZoom(newZoom);\n    } else {\n      // Scroll horizontally\n      setScrollX(prev => Math.max(0, prev - e.deltaX));\n    }\n  };\n  const resetView = () => {\n    setZoom(2.5); // Reset to default zoom\n    setScrollX(0);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"space-y-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex items-center justify-between\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center gap-2\",\n        children: [/*#__PURE__*/_jsxDEV(Music, {\n          className: \"w-5 h-5 text-gray-600\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-sm font-medium text-gray-600\",\n          children: \"Piano Roll\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center gap-2\",\n        children: [midiData && midiData.notes && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: isPlaying ? stopPlayback : startPlayback,\n            className: \"flex items-center gap-1 px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded-md transition-colors\",\n            children: [isPlaying ? /*#__PURE__*/_jsxDEV(Pause, {\n              className: \"w-3 h-3\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 260,\n              columnNumber: 30\n            }, this) : /*#__PURE__*/_jsxDEV(Play, {\n              className: \"w-3 h-3\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 260,\n              columnNumber: 62\n            }, this), isPlaying ? 'Stop' : 'Play']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 256,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center gap-1\",\n            children: [/*#__PURE__*/_jsxDEV(Volume2, {\n              className: \"w-3 h-3 text-gray-500\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 264,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"range\",\n              min: \"0\",\n              max: \"1\",\n              step: \"0.1\",\n              value: volume,\n              onChange: e => setVolume(parseFloat(e.target.value)),\n              className: \"w-16 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 265,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 263,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: resetView,\n          className: \"px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-md transition-colors\",\n          children: \"Reset View\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 277,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-xs text-gray-500\",\n          children: [\"Zoom: \", Math.round(zoom * 100), \"%\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 283,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"relative\",\n      children: [!midiData && !isConverting && /*#__PURE__*/_jsxDEV(motion.div, {\n        initial: {\n          opacity: 0\n        },\n        animate: {\n          opacity: 1\n        },\n        className: \"absolute inset-0 flex items-center justify-center bg-gray-50 rounded-lg border-2 border-dashed border-gray-300\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-center\",\n          children: [/*#__PURE__*/_jsxDEV(Music, {\n            className: \"w-12 h-12 text-gray-400 mx-auto mb-3\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-gray-500 text-sm\",\n            children: \"Convert audio to see piano roll visualization\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 298,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 11\n      }, this), isConverting && /*#__PURE__*/_jsxDEV(motion.div, {\n        initial: {\n          opacity: 0\n        },\n        animate: {\n          opacity: 1\n        },\n        className: \"absolute inset-0 flex items-center justify-center bg-gray-50 rounded-lg\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-center\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-3\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 312,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-gray-500 text-sm\",\n            children: \"Converting audio...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 313,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 306,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"piano-roll rounded-lg overflow-hidden custom-scrollbar\",\n        style: {\n          height: '500px'\n        } // Increased height for better visibility\n        ,\n        children: /*#__PURE__*/_jsxDEV(\"canvas\", {\n          ref: canvasRef,\n          onWheel: handleWheel,\n          className: \"piano-roll-grid w-full h-full cursor-grab active:cursor-grabbing\",\n          style: {\n            background: '#1a1a1a',\n            touchAction: 'none'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 324,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 9\n      }, this), midiData && midiData.notes && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-2 space-y-1\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center justify-between text-xs text-gray-500\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: formatTime(currentTime)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 339,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: formatTime(midiData.duration)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 340,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 338,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-full bg-gray-200 rounded-full h-1\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bg-blue-500 h-1 rounded-full transition-all duration-100\",\n            style: {\n              width: `${currentTime / midiData.duration * 100}%`\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 343,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 342,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 337,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-2 text-xs text-gray-500\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Scroll to navigate \\u2022 Ctrl+Scroll to zoom \\u2022 \", (midiData === null || midiData === void 0 ? void 0 : (_midiData$notes = midiData.notes) === null || _midiData$notes === void 0 ? void 0 : _midiData$notes.length) || 0, \" notes\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 352,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 351,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 246,\n    columnNumber: 5\n  }, this);\n};\n_s(PianoRoll, \"DZoiUufekJt56I6wVXM3WzpZ2bY=\");\n_c = PianoRoll;\nexport default PianoRoll;\nvar _c;\n$RefreshReg$(_c, \"PianoRoll\");","map":{"version":3,"names":["React","useRef","useEffect","useState","motion","Music","Play","Pause","Volume2","jsxDEV","_jsxDEV","PianoRoll","midiData","isConverting","_s","_midiData$notes","canvasRef","dimensions","setDimensions","width","height","zoom","setZoom","scrollX","setScrollX","isPlaying","setIsPlaying","currentTime","setCurrentTime","volume","setVolume","audioContextRef","playbackStartTimeRef","animationFrameRef","noteNames","octaves","pianoKeys","forEach","octave","note","push","updateDimensions","current","rect","getBoundingClientRect","window","addEventListener","removeEventListener","canvas","ctx","getContext","clearRect","drawGrid","notes","drawNotes","createSynth","AudioContext","webkitAudioContext","playNote","frequency","startTime","duration","velocity","audioContext","gainNode","createGain","oscillator","createOscillator","connect","destination","setValueAtTime","type","velocityGain","gain","linearRampToValueAtTime","exponentialRampToValueAtTime","start","stop","midiNoteToFrequency","Math","pow","startPlayback","pitch","end","updatePlayback","elapsed","requestAnimationFrame","stopPlayback","cancelAnimationFrame","gridSize","keyHeight","length","strokeStyle","lineWidth","i","y","beginPath","moveTo","lineTo","stroke","x","timeScale","noteIndex","noteWidth","noteHeight","isCurrentlyPlaying","gradient","createLinearGradient","addColorStop","fillStyle","fillRect","strokeRect","formatTime","time","minutes","floor","seconds","toString","padStart","handleWheel","e","preventDefault","ctrlKey","metaKey","newZoom","max","min","deltaY","prev","deltaX","resetView","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","step","value","onChange","parseFloat","target","round","div","initial","opacity","animate","style","ref","onWheel","background","touchAction","_c","$RefreshReg$"],"sources":["/root/Audiotomidi/src/components/PianoRoll.js"],"sourcesContent":["import React, { useRef, useEffect, useState } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { Music, Play, Pause, Volume2 } from 'lucide-react';\r\n\r\nconst PianoRoll = ({ midiData, isConverting }) => {\r\n  const canvasRef = useRef(null);\r\n  const [dimensions, setDimensions] = useState({ width: 0, height: 0 });\r\n  const [zoom, setZoom] = useState(2.5); // Start more zoomed in\r\n  const [scrollX, setScrollX] = useState(0);\r\n  \r\n  // MIDI playback state\r\n  const [isPlaying, setIsPlaying] = useState(false);\r\n  const [currentTime, setCurrentTime] = useState(0);\r\n  const [volume, setVolume] = useState(0.7);\r\n  const audioContextRef = useRef(null);\r\n  const playbackStartTimeRef = useRef(0);\r\n  const animationFrameRef = useRef(null);\r\n\r\n  // Piano key names - reduced range for less cramped view\r\n  const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\r\n  const octaves = [6, 5, 4, 3]; // Reduced octave range\r\n  const pianoKeys = [];\r\n  \r\n  octaves.forEach(octave => {\r\n    noteNames.forEach(note => {\r\n      pianoKeys.push(`${note}${octave}`);\r\n    });\r\n  });\r\n\r\n  useEffect(() => {\r\n    const updateDimensions = () => {\r\n      if (canvasRef.current) {\r\n        const rect = canvasRef.current.getBoundingClientRect();\r\n        setDimensions({ width: rect.width, height: rect.height });\r\n      }\r\n    };\r\n\r\n    updateDimensions();\r\n    window.addEventListener('resize', updateDimensions);\r\n    return () => window.removeEventListener('resize', updateDimensions);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!canvasRef.current || !midiData || !dimensions.width) return;\r\n\r\n    const canvas = canvasRef.current;\r\n    const ctx = canvas.getContext('2d');\r\n    \r\n    // Set canvas size\r\n    canvas.width = dimensions.width;\r\n    canvas.height = dimensions.height;\r\n\r\n    // Clear canvas\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    // Draw grid\r\n    drawGrid(ctx, canvas.width, canvas.height);\r\n    \r\n    // Draw notes if available\r\n    if (midiData.notes) {\r\n      drawNotes(ctx, midiData.notes, canvas.width, canvas.height);\r\n    }\r\n\r\n  }, [midiData, dimensions, zoom, scrollX]);\r\n\r\n  // MIDI Synthesizer\r\n  const createSynth = () => {\r\n    if (!audioContextRef.current) {\r\n      audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();\r\n    }\r\n    return audioContextRef.current;\r\n  };\r\n\r\n  const playNote = (frequency, startTime, duration, velocity = 100) => {\r\n    const audioContext = createSynth();\r\n    const gainNode = audioContext.createGain();\r\n    const oscillator = audioContext.createOscillator();\r\n    \r\n    // Connect nodes\r\n    oscillator.connect(gainNode);\r\n    gainNode.connect(audioContext.destination);\r\n    \r\n    // Set oscillator properties\r\n    oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);\r\n    oscillator.type = 'triangle'; // Warm, musical sound\r\n    \r\n    // Set envelope\r\n    const velocityGain = (velocity / 127) * volume;\r\n    gainNode.gain.setValueAtTime(0, audioContext.currentTime);\r\n    gainNode.gain.linearRampToValueAtTime(velocityGain, audioContext.currentTime + 0.01);\r\n    gainNode.gain.exponentialRampToValueAtTime(velocityGain * 0.3, audioContext.currentTime + duration);\r\n    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration + 0.1);\r\n    \r\n    // Start and stop\r\n    oscillator.start(audioContext.currentTime + startTime);\r\n    oscillator.stop(audioContext.currentTime + startTime + duration + 0.1);\r\n  };\r\n\r\n  const midiNoteToFrequency = (note) => {\r\n    return 440 * Math.pow(2, (note - 69) / 12);\r\n  };\r\n\r\n  const startPlayback = () => {\r\n    if (!midiData || !midiData.notes) return;\r\n    \r\n    setIsPlaying(true);\r\n    setCurrentTime(0);\r\n    const audioContext = createSynth();\r\n    playbackStartTimeRef.current = audioContext.currentTime;\r\n    \r\n    // Schedule all notes\r\n    midiData.notes.forEach(note => {\r\n      const frequency = midiNoteToFrequency(note.pitch);\r\n      const duration = note.end - note.start;\r\n      playNote(frequency, note.start, duration, note.velocity);\r\n    });\r\n    \r\n    // Update playback position\r\n    const updatePlayback = () => {\r\n      if (!isPlaying) return;\r\n      \r\n      const elapsed = audioContext.currentTime - playbackStartTimeRef.current;\r\n      setCurrentTime(elapsed);\r\n      \r\n      if (elapsed < midiData.duration) {\r\n        animationFrameRef.current = requestAnimationFrame(updatePlayback);\r\n      } else {\r\n        setIsPlaying(false);\r\n        setCurrentTime(0);\r\n      }\r\n    };\r\n    \r\n    updatePlayback();\r\n  };\r\n\r\n  const stopPlayback = () => {\r\n    setIsPlaying(false);\r\n    setCurrentTime(0);\r\n    if (animationFrameRef.current) {\r\n      cancelAnimationFrame(animationFrameRef.current);\r\n    }\r\n  };\r\n\r\n  // Cleanup on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (animationFrameRef.current) {\r\n        cancelAnimationFrame(animationFrameRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const drawGrid = (ctx, width, height) => {\r\n    const gridSize = 30 * zoom; // Larger grid spacing\r\n    const keyHeight = height / pianoKeys.length;\r\n\r\n    // Draw horizontal lines (piano keys) - more subtle\r\n    ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';\r\n    ctx.lineWidth = 0.5;\r\n    \r\n    for (let i = 0; i <= pianoKeys.length; i++) {\r\n      const y = i * keyHeight;\r\n      ctx.beginPath();\r\n      ctx.moveTo(0, y);\r\n      ctx.lineTo(width, y);\r\n      ctx.stroke();\r\n    }\r\n\r\n    // Draw vertical lines (time grid) - more subtle\r\n    ctx.strokeStyle = 'rgba(255, 255, 255, 0.08)';\r\n    for (let x = 0; x <= width; x += gridSize) {\r\n      ctx.beginPath();\r\n      ctx.moveTo(x - scrollX, 0);\r\n      ctx.lineTo(x - scrollX, height);\r\n      ctx.stroke();\r\n    }\r\n\r\n    // Removed note labels for cleaner look\r\n  };\r\n\r\n  const drawNotes = (ctx, notes, width, height) => {\r\n    const keyHeight = height / pianoKeys.length;\r\n    const timeScale = 150 * zoom; // Increased time scale for better visibility\r\n\r\n    notes.forEach(note => {\r\n      const noteIndex = note.pitch - 21; // MIDI note 21 is A0\r\n      if (noteIndex >= 0 && noteIndex < pianoKeys.length) {\r\n        const y = noteIndex * keyHeight;\r\n        const x = note.start * timeScale - scrollX;\r\n        const noteWidth = (note.end - note.start) * timeScale;\r\n        const noteHeight = keyHeight * 0.9; // Slightly larger notes\r\n\r\n        // Check if note is currently playing\r\n        const isCurrentlyPlaying = isPlaying && \r\n          currentTime >= note.start && \r\n          currentTime <= note.end;\r\n\r\n        // Draw note rectangle with better colors\r\n        const gradient = ctx.createLinearGradient(x, y, x + noteWidth, y);\r\n        if (isCurrentlyPlaying) {\r\n          // Highlight currently playing notes\r\n          gradient.addColorStop(0, '#fbbf24'); // Yellow\r\n          gradient.addColorStop(0.5, '#f59e0b'); // Orange\r\n          gradient.addColorStop(1, '#d97706'); // Dark orange\r\n        } else {\r\n          gradient.addColorStop(0, '#60a5fa'); // Lighter blue\r\n          gradient.addColorStop(0.5, '#8b5cf6'); // Purple\r\n          gradient.addColorStop(1, '#a855f7'); // Lighter purple\r\n        }\r\n        \r\n        ctx.fillStyle = gradient;\r\n        ctx.fillRect(x, y + keyHeight * 0.05, noteWidth, noteHeight);\r\n        \r\n        // Draw note border with glow effect\r\n        ctx.strokeStyle = isCurrentlyPlaying ? 'rgba(255, 255, 255, 0.8)' : 'rgba(255, 255, 255, 0.4)';\r\n        ctx.lineWidth = isCurrentlyPlaying ? 2 : 1.5;\r\n        ctx.strokeRect(x, y + keyHeight * 0.05, noteWidth, noteHeight);\r\n      }\r\n    });\r\n  };\r\n\r\n  const formatTime = (time) => {\r\n    const minutes = Math.floor(time / 60);\r\n    const seconds = Math.floor(time % 60);\r\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\r\n  };\r\n\r\n  const handleWheel = (e) => {\r\n    e.preventDefault();\r\n    if (e.ctrlKey || e.metaKey) {\r\n      // Zoom\r\n      const newZoom = Math.max(1, Math.min(5, zoom - e.deltaY * 0.001));\r\n      setZoom(newZoom);\r\n    } else {\r\n      // Scroll horizontally\r\n      setScrollX(prev => Math.max(0, prev - e.deltaX));\r\n    }\r\n  };\r\n\r\n  const resetView = () => {\r\n    setZoom(2.5); // Reset to default zoom\r\n    setScrollX(0);\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <Music className=\"w-5 h-5 text-gray-600\" />\r\n          <span className=\"text-sm font-medium text-gray-600\">Piano Roll</span>\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n          {/* Playback Controls */}\r\n          {midiData && midiData.notes && (\r\n            <div className=\"flex items-center gap-2\">\r\n              <button\r\n                onClick={isPlaying ? stopPlayback : startPlayback}\r\n                className=\"flex items-center gap-1 px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded-md transition-colors\"\r\n              >\r\n                {isPlaying ? <Pause className=\"w-3 h-3\" /> : <Play className=\"w-3 h-3\" />}\r\n                {isPlaying ? 'Stop' : 'Play'}\r\n              </button>\r\n              <div className=\"flex items-center gap-1\">\r\n                <Volume2 className=\"w-3 h-3 text-gray-500\" />\r\n                <input\r\n                  type=\"range\"\r\n                  min=\"0\"\r\n                  max=\"1\"\r\n                  step=\"0.1\"\r\n                  value={volume}\r\n                  onChange={(e) => setVolume(parseFloat(e.target.value))}\r\n                  className=\"w-16 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer\"\r\n                />\r\n              </div>\r\n            </div>\r\n          )}\r\n          <button\r\n            onClick={resetView}\r\n            className=\"px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-md transition-colors\"\r\n          >\r\n            Reset View\r\n          </button>\r\n          <span className=\"text-xs text-gray-500\">\r\n            Zoom: {Math.round(zoom * 100)}%\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"relative\">\r\n        {!midiData && !isConverting && (\r\n          <motion.div\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            className=\"absolute inset-0 flex items-center justify-center bg-gray-50 rounded-lg border-2 border-dashed border-gray-300\"\r\n          >\r\n            <div className=\"text-center\">\r\n              <Music className=\"w-12 h-12 text-gray-400 mx-auto mb-3\" />\r\n              <p className=\"text-gray-500 text-sm\">\r\n                Convert audio to see piano roll visualization\r\n              </p>\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n\r\n        {isConverting && (\r\n          <motion.div\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            className=\"absolute inset-0 flex items-center justify-center bg-gray-50 rounded-lg\"\r\n          >\r\n            <div className=\"text-center\">\r\n              <div className=\"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-3\"></div>\r\n              <p className=\"text-gray-500 text-sm\">\r\n                Converting audio...\r\n              </p>\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n\r\n        <div \r\n          className=\"piano-roll rounded-lg overflow-hidden custom-scrollbar\"\r\n          style={{ height: '500px' }} // Increased height for better visibility\r\n        >\r\n          <canvas\r\n            ref={canvasRef}\r\n            onWheel={handleWheel}\r\n            className=\"piano-roll-grid w-full h-full cursor-grab active:cursor-grabbing\"\r\n            style={{ \r\n              background: '#1a1a1a',\r\n              touchAction: 'none'\r\n            }}\r\n          />\r\n        </div>\r\n\r\n        {/* Playback Progress */}\r\n        {midiData && midiData.notes && (\r\n          <div className=\"mt-2 space-y-1\">\r\n            <div className=\"flex items-center justify-between text-xs text-gray-500\">\r\n              <span>{formatTime(currentTime)}</span>\r\n              <span>{formatTime(midiData.duration)}</span>\r\n            </div>\r\n            <div className=\"w-full bg-gray-200 rounded-full h-1\">\r\n              <div \r\n                className=\"bg-blue-500 h-1 rounded-full transition-all duration-100\"\r\n                style={{ width: `${(currentTime / midiData.duration) * 100}%` }}\r\n              />\r\n            </div>\r\n          </div>\r\n        )}\r\n        \r\n        <div className=\"mt-2 text-xs text-gray-500\">\r\n          <p>Scroll to navigate • Ctrl+Scroll to zoom • {midiData?.notes?.length || 0} notes</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PianoRoll; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}